<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive crime visualization dashboard for Charlotte, NC">
    <title>Crime Lens of CLT</title>

    <!-- D3.js Library -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- Leaflet for map tiles -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- External Stylesheet -->
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="favicon/favicon.ico" sizes="any">
</head>
<body>
<!-- Header Section -->
<header class="dashboard-header">
    <div class="container">
        <a class="brand" href="/">
            <img src="/favicon/crime-lens-charlotte.svg"
                 alt="Crime Lens of Charlotte"
                 width="150" height="150" decoding="async" fetchpriority="high"/>
        </a>
        <h1 class="dashboard-title" style="text-align: center;">Crime Lens of Charlotte</h1>
        <p class="dashboard-subtitle" style="text-align: center;">Exploring Crime in Charlotte</p>
    </div>
</header>

<!-- Main Dashboard Container -->
<main class="dashboard-main">
    <div class="container">

        <!-- Control Panel -->
        <section class="control-panel" id="controlPanel">
            <h2 class="section-title" style="text-align: center;">Filters & Controls</h2>

            <div class="control-grid">
                <!-- Date Range Filter -->
                <div class="control-group">
                    <label for="dateRange">Date Range</label>
                    <div class="date-inputs">
                        <input type="date" id="startDate" name="startDate" aria-label="Start date">
                        <span class="date-separator">to</span>
                        <input type="date" id="endDate" name="endDate" aria-label="End date">
                    </div>
                </div>

                <!-- Crime Type Filter -->
                <div class="control-group">
                    <label for="crimeType">Crime Type</label>
                    <span class="helper-text">Select one or Ctrl+Click for multiple</span>
                    <select id="crimeType" name="crimeType" multiple size="8" aria-label="Select crime types">
                        <option value="all" selected>All Crime Types</option>
                        <option value="violent">Violent Crimes</option>
                        <option value="sex">Sex Crimes</option>
                        <option value="property">Property Crimes</option>
                        <option value="fraud">Fraud / Financial Crimes</option>
                        <option value="drug">Drug & Alcohol Offenses</option>
                        <option value="publicOrder">Public Order Crimes</option>
                        <option value="weapons">Weapons Offenses</option>
                        <option value="other">Special / Other Incidents</option>
                    </select>
                </div>

                <!-- ZIP Code Filter -->
                <div class="control-group">
                    <label for="zipCode">ZIP Code</label>
                    <select id="zipCode" name="zipCode" aria-label="Select ZIP code">
                        <option value="all" selected>All ZIP Codes</option>
                        <!-- ZIP codes will be populated dynamically -->
                    </select>
                </div>

                <!-- Reset Button -->
                <div class="control-group">
                    <button id="resetFilters" class="btn-reset" aria-label="Reset all filters">
                        Reset Filters
                    </button>
                </div>
            </div>
        </section>

        <!-- Visualization Grid -->
        <div class="visualization-grid">

            <!-- Map Visualization -->
            <section class="viz-panel viz-panel-large" id="mapPanel">
                <div class="panel-header">
                    <h2 class="panel-title">Crime Map</h2>
                    <div class="panel-controls">
                        <button class="btn-view-toggle" id="mapViewToggle" aria-label="Toggle map view">
                            <span class="view-option active" data-view="heatmap">All Incidents</span>
                            <span class="view-option" data-view="choropleth">Crime Density</span>
                            <span class="view-option" data-view="points">Individual Points</span>
                        </button>
                    </div>
                </div>
                <div class="panel-content">
                    <div id="mapVisualization" style="height: 600px; width: 100%;"></div>
                    <div class="map-legend" id="mapLegend"></div>
                </div>
            </section>

            <!-- Temporal Trend Visualization -->
            <section class="viz-panel" id="trendPanel">
                <div class="panel-header">
                    <h2 class="panel-title">Crime Trends Over Time</h2>
                </div>
                <div class="panel-content">
                    <svg id="trendVisualization" role="img" aria-label="Crime trend line chart"></svg>
                </div>
            </section>

            <!-- Crime Type Distribution -->
            <section class="viz-panel" id="distributionPanel">
                <div class="panel-header">
                    <h2 class="panel-title">Crime Type Distribution</h2>
                </div>
                <div class="panel-content">
                    <svg id="distributionVisualization" role="img" aria-label="Crime type bar chart"></svg>
                </div>
            </section>

            <!-- Statistics Summary -->
            <section class="viz-panel" id="statsPanel">
                <div class="panel-header">
                    <h2 class="panel-title">Key Statistics</h2>
                </div>
                <div class="panel-content stats-grid">
                    <div class="stat-card">
                        <span class="stat-value" id="totalCrimes">-</span>
                        <span class="stat-label">Total Incidents</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="violentCrimes">-</span>
                        <span class="stat-label">Violent Crimes</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="propertyCrimes">-</span>
                        <span class="stat-label">Property Crimes</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="crimeRate">-</span>
                        <span class="stat-label">Avg. per Day</span>
                    </div>
                </div>
            </section>

        </div>

        <!-- Data Info Panel -->
        <section class="info-panel" id="dataInfo">
            <div class="info-content data-grid">
                <div class="data-copy">
                    <h3>About This Data</h3>
                    <p>
                        Crime data is sourced directly from the Charlotte-Mecklenburg Police Department (CMPD)
                        via the <a href="https://data.charlottenc.gov" target="_blank" rel="noopener noreferrer">
                        Charlotte Open Data Portal</a>. The dashboard reflects reported incidents classified using
                        FBI NIBRS standards.
                    </p>
                </div>

                <nav class="dataset-list" aria-label="Datasets">
                    <ul class="link-list">
                        <li>
                            <a href="https://data.charlottenc.gov/datasets/charlotte::cmpd-incidents-1/about"
                               target="_blank" rel="noopener noreferrer">CMPD Incidents</a>
                        </li>
                        <li>
                            <a href="https://data.charlottenc.gov/datasets/charlotte::zip-codes/about"
                               target="_blank" rel="noopener noreferrer">ZIP Codes</a>
                        </li>
                        <li>
                            <a href="https://data.charlottenc.gov/datasets/charlotte::cmpd-homicide/about"
                               target="_blank" rel="noopener noreferrer">Homicides</a>
                        </li>
                        <li>
                            <a href="https://data.charlottenc.gov/datasets/charlotte::cmpd-violent-crime/about"
                               target="_blank" rel="noopener noreferrer">Violent Crimes</a>
                        </li>
                    </ul>
                </nav>

                <p class="data-timestamp">
                    <strong>Last Updated:</strong>
                    <time id="lastUpdated">Loading...</time>
                </p>
            </div>
        </section>

    </div>
</main>

<!-- Footer -->
<footer class="dashboard-footer">
    <div class="container">
        <p>&copy; Crime Lens of Charlotte</p>
        <p>DATA 760: VISUALIZATION & COMMUNICATION</p>
        <p>Creator: Mahek Patel</p>
    </div>
</footer>

<!-- Tooltip (for interactive elements) -->
<div id="tooltip" class="tooltip" role="tooltip" aria-hidden="true"></div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <p class="loading-text">Loading crime data...</p>
</div>

<!-- D3 Visualization Script -->
<script src="visualization.js"></script>
</body>
</html>